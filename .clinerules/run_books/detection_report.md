# Runbook: Generate Detection Report (Placeholder)

## Objective

*(Define the goal, e.g., To summarize the findings, logic, and performance of a specific detection rule or a set of related rules, often used for review, tuning documentation, or reporting on detection capabilities.)*

## Scope

*(Define what is included/excluded, e.g., Focuses on summarizing existing information about a detection. May include data from validation/tuning efforts but doesn't typically involve executing new validation steps.)*

## Inputs

*   `${RULE_ID}` or `${RULE_IDS}`: The identifier(s) of the detection rule(s) to report on.
*   *(Optional) `${REPORT_TIMEFRAME_DAYS}`: Timeframe for performance data (e.g., 90).*
*   *(Optional) `${CASE_ID}`: Relevant SOAR case ID if the report relates to a specific incident or tuning effort.*

## Tools

*   `secops-mcp`: `list_security_rules`, `get_security_alerts` (for performance data)
*   `secops-soar`: `get_case_full_details`, `post_case_comment` (for context/documentation)
*   `write_to_file`

## Workflow Steps & Diagram

1.  **Gather Rule Details:** Retrieve the rule logic/definition for `${RULE_ID}` using `list_security_rules`.
2.  **Gather Performance Data:** Retrieve historical alerts generated by the rule over `${REPORT_TIMEFRAME_DAYS}` using `get_security_alerts`. Analyze volume, severity, and potentially associated case statuses (TP/FP).
3.  **Gather Context:** Review related SOAR cases (`${CASE_ID}`) or tuning documentation if applicable.
4.  **Structure Report:** Organize information according to a standard template (referencing `.clinerules/reporting_templates.md`). Key sections might include: Rule Details (ID, Name, Logic Summary), Performance Metrics (Alert Volume, TP/FP Ratio if known), Key Findings/Observations, Tuning History/Recommendations (if applicable).
5.  **Generate Mermaid Diagram:** Create a Mermaid sequence diagram summarizing the *tools used to gather data for this report*.
6.  **Format Report:** Compile the synthesized information and the Mermaid diagram into a final Markdown report.
7.  **Write Report File:** Save the report using `write_to_file` with a standardized name (e.g., `./reports/detection_report_${RULE_ID}_${timestamp}.md`).

```{mermaid}
sequenceDiagram
    participant Analyst/User
    participant Cline as Cline (MCP Client)
    participant SIEM as secops-mcp
    participant SOAR as secops-soar

    Analyst/User->>Cline: Generate Detection Report\nInput: RULE_ID, REPORT_TIMEFRAME_DAYS, ...

    %% Step 1: Gather Rule Details
    Cline->>SIEM: list_security_rules(rule_id=RULE_ID)
    SIEM-->>Cline: Rule Definition/Logic

    %% Step 2: Gather Performance Data
    Cline->>SIEM: get_security_alerts(rule_id=RULE_ID, hours_back=REPORT_TIMEFRAME_DAYS*24)
    SIEM-->>Cline: Historical Alert Data
    Note over Cline: Analyze performance metrics

    %% Step 3: Gather Context (Optional)
    opt Case ID Provided
        Cline->>SOAR: get_case_full_details(case_id=CASE_ID)
        SOAR-->>Cline: Case Context / Tuning Notes
    end

    %% Step 4 & 5: Structure Report & Generate Diagram
    Note over Cline: Organize report sections (Rule Details, Performance, Findings...)
    Note over Cline: Create Mermaid diagram summarizing report generation steps

    %% Step 6 & 7: Format & Write Report
    Note over Cline: Compile final Markdown content
    Cline->>Cline: write_to_file(path="./reports/detection_report_...", content=ReportMarkdown)
    Note over Cline: Report file created

    Cline->>Analyst/User: attempt_completion(result="Detection report generated for RULE_ID.")

```

## Completion Criteria

*(Define how successful completion is determined, e.g., Report generated containing rule details and performance summary, report saved.)*
